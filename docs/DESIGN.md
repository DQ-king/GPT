# 设计说明

本文档总结了拥堵检测服务的核心设计决策，方便后续维护与扩展。

## 聚类与拥堵判定
- **聚类算法**：使用基于半径的密度聚类（类似 DBSCAN 的核心思路）。以 `radius_meters` 为距离阈值，进行邻居扩展；聚类规模不足 `minimum_cluster_size` 的组被过滤。
- **拥堵等级**：优先依据车辆规模，其次参考平均速度：
  - 高拥堵：车辆数 ≥ 8，或平均速度 < 5 km/h。
  - 中拥堵：车辆数 ≥ 5，或平均速度 < 15 km/h。
  - 低拥堵：其他情况，且速度缺失时采取保守判定（只看车辆规模）。

## 区域边界输出
- **目标**：输出的拥堵区域尽可能为多边形，以便前端或 GIS 系统直接渲染。
- **生成方式**：对聚类内车辆坐标（经纬度）计算凸包，采用单调链算法保证 O(n log n) 复杂度。
- **坐标顺序**：按顺时针或逆时针返回凸包坐标，避免自交。
- **退化场景**：虽然聚类最小规模是 3，但为健壮性，单点/两点情况会退化为点或矩形包络。

## 模型与接口
- `CongestionRegion` 增加 `boundary` 字段，返回凸包坐标列表。
- API 响应模型在 `/congestion` 端点中直接复用，便于客户端消费。

## 可扩展性考虑
- 未来若需要更平滑的边界，可在凸包基础上套用缓冲区或 alpha shape，但当前凸包满足性能和可解释性需求。
- 半径和最小聚类规模可在 `CongestionService` 初始化时配置，便于不同城市或路况场景调整。
